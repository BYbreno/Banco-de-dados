-- Criar Base de Dados
CREATE DATABASE Livraria;
USE Livraria;

-- Criar Tabelas
CREATE TABLE Sessao (
    Codigo INT PRIMARY KEY,
    Descricao VARCHAR(50),
    Localizacao VARCHAR(100)
);

CREATE TABLE Livro (
    Cod_Livro INT PRIMARY KEY,
    Titulo VARCHAR(100),
    Autor VARCHAR(100),
    Editora VARCHAR(100),
    Ano_Publicacao INT,
    Cod_Sessao INT,
    FOREIGN KEY (Cod_Sessao) REFERENCES Sessao(Codigo)
);

CREATE TABLE Leitor (
    Matricula INT PRIMARY KEY,
    Nome VARCHAR(100),
    Email VARCHAR(100),
    Telefone VARCHAR(20),
    Endereco VARCHAR(200)
);

CREATE TABLE Emprestimo (
    Cod_Emprestimo INT PRIMARY KEY,
    Cod_Livro INT,
    Matricula INT,
    Data_Emprestimo DATE,
    Data_Devolucao DATE,
    Data_Devolucao_Real DATE,
    FOREIGN KEY (Cod_Livro) REFERENCES Livro(Cod_Livro),
    FOREIGN KEY (Matricula) REFERENCES Leitor(Matricula)
);

-- Inserir Dados
INSERT INTO Sessao (Codigo, Descricao, Localizacao) VALUES
(1, 'Ficção', 'A1'),
(2, 'História', 'B2'),
(3, 'Tecnologia', 'C3');

INSERT INTO Livro (Cod_Livro, Titulo, Autor, Editora, Ano_Publicacao, Cod_Sessao) VALUES
(1, 'A Revolução dos Bichos', 'George Orwell', 'Companhia das Letras', 2007, 1),
(2, '1984', 'George Orwell', 'Companhia das Letras', 2009, 1),
(3, 'O Guia do Mochileiro das Galáxias', 'Douglas Adams', 'Arqueiro', 2004, 3);

INSERT INTO Leitor (Matricula, Nome, Email, Telefone, Endereco) VALUES
(1, 'João Silva', 'joao@gmail.com', '123456789', 'Rua A, 123'),
(2, 'Maria Souza', 'maria@gmail.com', '987654321', 'Rua B, 456');

INSERT INTO Emprestimo (Cod_Emprestimo, Cod_Livro, Matricula, Data_Emprestimo, Data_Devolucao, Data_Devolucao_Real) VALUES
(1, 1, 1, '2024-10-01', '2024-10-15', NULL),
(2, 3, 2, '2024-09-20', '2024-10-05', '2024-10-03');

-- Consultas com Joins
-- Listar Títulos dos Livros Emprestados por 'João Silva'
SELECT l.Titulo, e.Data_Emprestimo
FROM Emprestimo e
INNER JOIN Livro l ON e.Cod_Livro = l.Cod_Livro
INNER JOIN Leitor a ON e.Matricula = a.Matricula
WHERE a.Nome LIKE 'João Silva';

-- Listar Livros por Sessão 'Tecnologia'
SELECT l.Titulo
FROM Livro l
INNER JOIN Sessao s ON l.Cod_Sessao = s.Codigo
WHERE s.Descricao = 'Tecnologia';
